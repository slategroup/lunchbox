/*
 * Looking for the full, uncompressed source? Try here:
 *
 * https://github.com/nprapps/lunchbox
 *
 * The following files are included in this compressed version:
 *
 * www/js/lib/bootstrap.js
 * www/js/lib/fileinput.js
 * www/js/waterbug-config.js
 * www/js/waterbug.js
 */
if(typeof jQuery==="undefined")throw new Error("Bootstrap requires jQuery");+function($){"use strict";function transitionEnd(){var el=document.createElement('bootstrap');var transEndEventNames={'WebkitTransition':'webkitTransitionEnd','MozTransition':'transitionend','OTransition':'oTransitionEnd otransitionend','transition':'transitionend'};for(var name in transEndEventNames)if(el.style[name]!==undefined)return{end:transEndEventNames[name]};}$.fn.emulateTransitionEnd=function(duration){var called=false,$el=this;$(this).one($.support.transition.end,function(){called=true;});var callback=function(){if(!called)$($el).trigger($.support.transition.end);};setTimeout(callback,duration);return this;};$(function(){$.support.transition=transitionEnd();});}(jQuery);+function($){"use strict";var dismiss='[data-dismiss="alert"]';var Alert=function(el){$(el).on('click',dismiss,this.close);};Alert.prototype.close=function(e){var $this=$(this);var selector=$this.attr('data-target');if(!selector){selector=$this.attr('href');selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'');}var $parent=$(selector);if(e)e.preventDefault();if(!$parent.length)$parent=$this.hasClass('alert')?$this:$this.parent();$parent.trigger(e=$.Event('close.bs.alert'));if(e.isDefaultPrevented())return;$parent.removeClass('in');function removeElement(){$parent.trigger('closed.bs.alert').remove();}$.support.transition&&$parent.hasClass('fade')?$parent.one($.support.transition.end,removeElement).emulateTransitionEnd(150):removeElement();};var old=$.fn.alert;$.fn.alert=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.alert');if(!data)$this.data('bs.alert',(data=new Alert(this)));if(typeof option=='string')data[option].call($this);});};$.fn.alert.Constructor=Alert;$.fn.alert.noConflict=function(){$.fn.alert=old;return this;};$(document).on('click.bs.alert.data-api',dismiss,Alert.prototype.close);}(jQuery);+function($){"use strict";var Button=function(element,options){this.$element=$(element);this.options=$.extend({},Button.DEFAULTS,options);};Button.DEFAULTS={loadingText:'loading...'};Button.prototype.setState=function(state){var d='disabled';var $el=this.$element;var val=$el.is('input')?'val':'html';var data=$el.data();state=state+'Text';if(!data.resetText)$el.data('resetText',$el[val]());$el[val](data[state]||this.options[state]);setTimeout(function(){state=='loadingText'?$el.addClass(d).attr(d,d):$el.removeClass(d).removeAttr(d);},0);};Button.prototype.toggle=function(){var $parent=this.$element.closest('[data-toggle="buttons"]');var changed=true;if($parent.length){var $input=this.$element.find('input');if($input.prop('type')==='radio')if($input.prop('checked')&&this.$element.hasClass('active'))changed=false;else $parent.find('.active').removeClass('active');if(changed)$input.prop('checked',!this.$element.hasClass('active')).trigger('change');}if(changed)this.$element.toggleClass('active');};var old=$.fn.button;$.fn.button=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.button');var options=typeof option=='object'&&option;if(!data)$this.data('bs.button',(data=new Button(this,options)));if(option=='toggle')data.toggle();else if(option)data.setState(option);});};$.fn.button.Constructor=Button;$.fn.button.noConflict=function(){$.fn.button=old;return this;};$(document).on('click.bs.button.data-api','[data-toggle^=button]',function(e){var $btn=$(e.target);if(!$btn.hasClass('btn'))$btn=$btn.closest('.btn');$btn.button('toggle');e.preventDefault();});}(jQuery);+function($){"use strict";var Carousel=function(element,options){this.$element=$(element);this.$indicators=this.$element.find('.carousel-indicators');this.options=options;this.paused=this.sliding=this.interval=this.$active=this.$items=null;this.options.pause=='hover'&&this.$element.on('mouseenter',$.proxy(this.pause,this)).on('mouseleave',$.proxy(this.cycle,this));};Carousel.DEFAULTS={interval:5000,pause:'hover',wrap:true};Carousel.prototype.cycle=function(e){e||(this.paused=false);this.interval&&clearInterval(this.interval);this.options.interval&&!this.paused&&(this.interval=setInterval($.proxy(this.next,this),this.options.interval));return this;};Carousel.prototype.getActiveIndex=function(){this.$active=this.$element.find('.item.active');this.$items=this.$active.parent().children();return this.$items.index(this.$active);};Carousel.prototype.to=function(pos){var that=this;var activeIndex=this.getActiveIndex();if(pos>(this.$items.length-1)||pos<0)return;if(this.sliding)return this.$element.one('slid.bs.carousel',function(){that.to(pos);});if(activeIndex==pos)return this.pause().cycle();return this.slide(pos>activeIndex?'next':'prev',$(this.$items[pos]));};Carousel.prototype.pause=function(e){e||(this.paused=true);if(this.$element.find('.next, .prev').length&&$.support.transition.end){this.$element.trigger($.support.transition.end);this.cycle(true);}this.interval=clearInterval(this.interval);return this;};Carousel.prototype.next=function(){if(this.sliding)return;return this.slide('next');};Carousel.prototype.prev=function(){if(this.sliding)return;return this.slide('prev');};Carousel.prototype.slide=function(type,next){var $active=this.$element.find('.item.active');var $next=next||$active[type]();var isCycling=this.interval;var direction=type=='next'?'left':'right';var fallback=type=='next'?'first':'last';var that=this;if(!$next.length){if(!this.options.wrap)return;$next=this.$element.find('.item')[fallback]();}this.sliding=true;isCycling&&this.pause();var e=$.Event('slide.bs.carousel',{relatedTarget:$next[0],direction:direction});if($next.hasClass('active'))return;if(this.$indicators.length){this.$indicators.find('.active').removeClass('active');this.$element.one('slid.bs.carousel',function(){var $nextIndicator=$(that.$indicators.children()[that.getActiveIndex()]);$nextIndicator&&$nextIndicator.addClass('active');});}if($.support.transition&&this.$element.hasClass('slide')){this.$element.trigger(e);if(e.isDefaultPrevented())return;$next.addClass(type);$next[0].offsetWidth;$active.addClass(direction);$next.addClass(direction);$active.one($.support.transition.end,function(){$next.removeClass([type,direction].join(' ')).addClass('active');$active.removeClass(['active',direction].join(' '));that.sliding=false;setTimeout(function(){that.$element.trigger('slid.bs.carousel');},0);}).emulateTransitionEnd(600);}else{this.$element.trigger(e);if(e.isDefaultPrevented())return;$active.removeClass('active');$next.addClass('active');this.sliding=false;this.$element.trigger('slid.bs.carousel');}isCycling&&this.cycle();return this;};var old=$.fn.carousel;$.fn.carousel=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.carousel');var options=$.extend({},Carousel.DEFAULTS,$this.data(),typeof option=='object'&&option);var action=typeof option=='string'?option:options.slide;if(!data)$this.data('bs.carousel',(data=new Carousel(this,options)));if(typeof option=='number')data.to(option);else if(action)data[action]();else if(options.interval)data.pause().cycle();});};$.fn.carousel.Constructor=Carousel;$.fn.carousel.noConflict=function(){$.fn.carousel=old;return this;};$(document).on('click.bs.carousel.data-api','[data-slide], [data-slide-to]',function(e){var $this=$(this),href;var $target=$($this.attr('data-target')||(href=$this.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,''));var options=$.extend({},$target.data(),$this.data());var slideIndex=$this.attr('data-slide-to');if(slideIndex)options.interval=false;$target.carousel(options);if(slideIndex=$this.attr('data-slide-to'))$target.data('bs.carousel').to(slideIndex);e.preventDefault();});$(window).on('load',function(){$('[data-ride="carousel"]').each(function(){var $carousel=$(this);$carousel.carousel($carousel.data());});});}(jQuery);+function($){"use strict";var Collapse=function(element,options){this.$element=$(element);this.options=$.extend({},Collapse.DEFAULTS,options);this.transitioning=null;if(this.options.parent)this.$parent=$(this.options.parent);if(this.options.toggle)this.toggle();};Collapse.DEFAULTS={toggle:true};Collapse.prototype.dimension=function(){var hasWidth=this.$element.hasClass('width');return hasWidth?'width':'height';};Collapse.prototype.show=function(){if(this.transitioning||this.$element.hasClass('in'))return;var startEvent=$.Event('show.bs.collapse');this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;var actives=this.$parent&&this.$parent.find('> .panel > .in');if(actives&&actives.length){var hasData=actives.data('bs.collapse');if(hasData&&hasData.transitioning)return;actives.collapse('hide');hasData||actives.data('bs.collapse',null);}var dimension=this.dimension();this.$element.removeClass('collapse').addClass('collapsing')[dimension](0);this.transitioning=1;var complete=function(){this.$element.removeClass('collapsing').addClass('in')[dimension]('auto');this.transitioning=0;this.$element.trigger('shown.bs.collapse');};if(!$.support.transition)return complete.call(this);var scrollSize=$.camelCase(['scroll',dimension].join('-'));this.$element.one($.support.transition.end,$.proxy(complete,this)).emulateTransitionEnd(350)[dimension](this.$element[0][scrollSize]);};Collapse.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass('in'))return;var startEvent=$.Event('hide.bs.collapse');this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;var dimension=this.dimension();this.$element[dimension](this.$element[dimension]())[0].offsetHeight;this.$element.addClass('collapsing').removeClass('collapse').removeClass('in');this.transitioning=1;var complete=function(){this.transitioning=0;this.$element.trigger('hidden.bs.collapse').removeClass('collapsing').addClass('collapse');};if(!$.support.transition)return complete.call(this);this.$element[dimension](0).one($.support.transition.end,$.proxy(complete,this)).emulateTransitionEnd(350);};Collapse.prototype.toggle=function(){this[this.$element.hasClass('in')?'hide':'show']();};var old=$.fn.collapse;$.fn.collapse=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.collapse');var options=$.extend({},Collapse.DEFAULTS,$this.data(),typeof option=='object'&&option);if(!data)$this.data('bs.collapse',(data=new Collapse(this,options)));if(typeof option=='string')data[option]();});};$.fn.collapse.Constructor=Collapse;$.fn.collapse.noConflict=function(){$.fn.collapse=old;return this;};$(document).on('click.bs.collapse.data-api','[data-toggle=collapse]',function(e){var $this=$(this),href;var target=$this.attr('data-target')||e.preventDefault()||(href=$this.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,'');var $target=$(target);var data=$target.data('bs.collapse');var option=data?'toggle':$this.data();var parent=$this.attr('data-parent');var $parent=parent&&$(parent);if(!data||!data.transitioning){if($parent)$parent.find('[data-toggle=collapse][data-parent="'+parent+'"]').not($this).addClass('collapsed');$this[$target.hasClass('in')?'addClass':'removeClass']('collapsed');}$target.collapse(option);});}(jQuery);+function($){"use strict";var backdrop='.dropdown-backdrop';var toggle='[data-toggle=dropdown]';var Dropdown=function(element){$(element).on('click.bs.dropdown',this.toggle);};Dropdown.prototype.toggle=function(e){var $this=$(this);if($this.is('.disabled, :disabled'))return;var $parent=getParent($this);var isActive=$parent.hasClass('open');clearMenus();if(!isActive){if('ontouchstart' in document.documentElement&&!$parent.closest('.navbar-nav').length)$('<div class="dropdown-backdrop"/>').insertAfter($(this)).on('click',clearMenus);$parent.trigger(e=$.Event('show.bs.dropdown'));if(e.isDefaultPrevented())return;$parent.toggleClass('open').trigger('shown.bs.dropdown');$this.focus();}return false;};Dropdown.prototype.keydown=function(e){if(!/(38|40|27)/.test(e.keyCode))return;var $this=$(this);e.preventDefault();e.stopPropagation();if($this.is('.disabled, :disabled'))return;var $parent=getParent($this);var isActive=$parent.hasClass('open');if(!isActive||(isActive&&e.keyCode==27)){if(e.which==27)$parent.find(toggle).focus();return $this.click();}var $items=$('[role=menu] li:not(.divider):visible a',$parent);if(!$items.length)return;var index=$items.index($items.filter(':focus'));if(e.keyCode==38&&index>0)index--;if(e.keyCode==40&&index<$items.length-1)index++;if(!~index)index=0;$items.eq(index).focus();};function clearMenus(){$(backdrop).remove();$(toggle).each(function(e){var $parent=getParent($(this));if(!$parent.hasClass('open'))return;$parent.trigger(e=$.Event('hide.bs.dropdown'));if(e.isDefaultPrevented())return;$parent.removeClass('open').trigger('hidden.bs.dropdown');});}function getParent($this){var selector=$this.attr('data-target');if(!selector){selector=$this.attr('href');selector=selector&&/#/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,'');}var $parent=selector&&$(selector);return $parent&&$parent.length?$parent:$this.parent();}var old=$.fn.dropdown;$.fn.dropdown=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.dropdown');if(!data)$this.data('bs.dropdown',(data=new Dropdown(this)));if(typeof option=='string')data[option].call($this);});};$.fn.dropdown.Constructor=Dropdown;$.fn.dropdown.noConflict=function(){$.fn.dropdown=old;return this;};$(document).on('click.bs.dropdown.data-api',clearMenus).on('click.bs.dropdown.data-api','.dropdown form',function(e){e.stopPropagation();}).on('click.bs.dropdown.data-api',toggle,Dropdown.prototype.toggle).on('keydown.bs.dropdown.data-api',toggle+', [role=menu]',Dropdown.prototype.keydown);}(jQuery);+function($){"use strict";var Modal=function(element,options){this.options=options;this.$element=$(element);this.$backdrop=this.isShown=null;if(this.options.remote)this.$element.load(this.options.remote);};Modal.DEFAULTS={backdrop:true,keyboard:true,show:true};Modal.prototype.toggle=function(_relatedTarget){return this[!this.isShown?'show':'hide'](_relatedTarget);};Modal.prototype.show=function(_relatedTarget){var that=this;var e=$.Event('show.bs.modal',{relatedTarget:_relatedTarget});this.$element.trigger(e);if(this.isShown||e.isDefaultPrevented())return;this.isShown=true;this.escape();this.$element.on('click.dismiss.modal','[data-dismiss="modal"]',$.proxy(this.hide,this));this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass('fade');if(!that.$element.parent().length)that.$element.appendTo(document.body);that.$element.show();if(transition)that.$element[0].offsetWidth;that.$element.addClass('in').attr('aria-hidden',false);that.enforceFocus();var e=$.Event('shown.bs.modal',{relatedTarget:_relatedTarget});transition?that.$element.find('.modal-dialog').one($.support.transition.end,function(){that.$element.focus().trigger(e);}).emulateTransitionEnd(300):that.$element.focus().trigger(e);});};Modal.prototype.hide=function(e){if(e)e.preventDefault();e=$.Event('hide.bs.modal');this.$element.trigger(e);if(!this.isShown||e.isDefaultPrevented())return;this.isShown=false;this.escape();$(document).off('focusin.bs.modal');this.$element.removeClass('in').attr('aria-hidden',true).off('click.dismiss.modal');$.support.transition&&this.$element.hasClass('fade')?this.$element.one($.support.transition.end,$.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal();};Modal.prototype.enforceFocus=function(){$(document).off('focusin.bs.modal').on('focusin.bs.modal',$.proxy(function(e){if(this.$element[0]!==e.target&&!this.$element.has(e.target).length)this.$element.focus();},this));};Modal.prototype.escape=function(){if(this.isShown&&this.options.keyboard)this.$element.on('keyup.dismiss.bs.modal',$.proxy(function(e){e.which==27&&this.hide();},this));else if(!this.isShown)this.$element.off('keyup.dismiss.bs.modal');};Modal.prototype.hideModal=function(){var that=this;this.$element.hide();this.backdrop(function(){that.removeBackdrop();that.$element.trigger('hidden.bs.modal');});};Modal.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null;};Modal.prototype.backdrop=function(callback){var that=this;var animate=this.$element.hasClass('fade')?'fade':'';if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body);this.$element.on('click.dismiss.modal',$.proxy(function(e){if(e.target!==e.currentTarget)return;this.options.backdrop=='static'?this.$element[0].focus.call(this.$element[0]):this.hide.call(this);},this));if(doAnimate)this.$backdrop[0].offsetWidth;this.$backdrop.addClass('in');if(!callback)return;doAnimate?this.$backdrop.one($.support.transition.end,callback).emulateTransitionEnd(150):callback();}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass('in');$.support.transition&&this.$element.hasClass('fade')?this.$backdrop.one($.support.transition.end,callback).emulateTransitionEnd(150):callback();}else if(callback)callback();};var old=$.fn.modal;$.fn.modal=function(option,_relatedTarget){return this.each(function(){var $this=$(this);var data=$this.data('bs.modal');var options=$.extend({},Modal.DEFAULTS,$this.data(),typeof option=='object'&&option);if(!data)$this.data('bs.modal',(data=new Modal(this,options)));if(typeof option=='string')data[option](_relatedTarget);else if(options.show)data.show(_relatedTarget);});};$.fn.modal.Constructor=Modal;$.fn.modal.noConflict=function(){$.fn.modal=old;return this;};$(document).on('click.bs.modal.data-api','[data-toggle="modal"]',function(e){var $this=$(this);var href=$this.attr('href');var $target=$($this.attr('data-target')||(href&&href.replace(/.*(?=#[^\s]+$)/,'')));var option=$target.data('modal')?'toggle':$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());e.preventDefault();$target.modal(option,this).one('hide',function(){$this.is(':visible')&&$this.focus();});});$(document).on('show.bs.modal','.modal',function(){$(document.body).addClass('modal-open');}).on('hidden.bs.modal','.modal',function(){$(document.body).removeClass('modal-open');});}(jQuery);+function($){"use strict";var Tooltip=function(element,options){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null;this.init('tooltip',element,options);};Tooltip.DEFAULTS={animation:true,placement:'top',selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:'hover focus',title:'',delay:0,html:false,container:false};Tooltip.prototype.init=function(type,element,options){this.enabled=true;this.type=type;this.$element=$(element);this.options=this.getOptions(options);var triggers=this.options.trigger.split(' ');for(var i=triggers.length;i--;){var trigger=triggers[i];if(trigger=='click')this.$element.on('click.'+this.type,this.options.selector,$.proxy(this.toggle,this));else if(trigger!='manual'){var eventIn=trigger=='hover'?'mouseenter':'focus';var eventOut=trigger=='hover'?'mouseleave':'blur';this.$element.on(eventIn+'.'+this.type,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut+'.'+this.type,this.options.selector,$.proxy(this.leave,this));}}this.options.selector?(this._options=$.extend({},this.options,{trigger:'manual',selector:''})):this.fixTitle();};Tooltip.prototype.getDefaults=function(){return Tooltip.DEFAULTS;};Tooltip.prototype.getOptions=function(options){options=$.extend({},this.getDefaults(),this.$element.data(),options);if(options.delay&&typeof options.delay=='number')options.delay={show:options.delay,hide:options.delay};return options;};Tooltip.prototype.getDelegateOptions=function(){var options={};var defaults=this.getDefaults();this._options&&$.each(this._options,function(key,value){if(defaults[key]!=value)options[key]=value;});return options;};Tooltip.prototype.enter=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget)[this.type](this.getDelegateOptions()).data('bs.'+this.type);clearTimeout(self.timeout);self.hoverState='in';if(!self.options.delay||!self.options.delay.show)return self.show();self.timeout=setTimeout(function(){if(self.hoverState=='in')self.show();},self.options.delay.show);};Tooltip.prototype.leave=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget)[this.type](this.getDelegateOptions()).data('bs.'+this.type);clearTimeout(self.timeout);self.hoverState='out';if(!self.options.delay||!self.options.delay.hide)return self.hide();self.timeout=setTimeout(function(){if(self.hoverState=='out')self.hide();},self.options.delay.hide);};Tooltip.prototype.show=function(){var e=$.Event('show.bs.'+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);if(e.isDefaultPrevented())return;var $tip=this.tip();this.setContent();if(this.options.animation)$tip.addClass('fade');var placement=typeof this.options.placement=='function'?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;var autoToken=/\s?auto?\s?/i;var autoPlace=autoToken.test(placement);if(autoPlace)placement=placement.replace(autoToken,'')||'top';$tip.detach().css({top:0,left:0,display:'block'}).addClass(placement);this.options.container?$tip.appendTo(this.options.container):$tip.insertAfter(this.$element);var pos=this.getPosition();var actualWidth=$tip[0].offsetWidth;var actualHeight=$tip[0].offsetHeight;if(autoPlace){var $parent=this.$element.parent();var orgPlacement=placement;var docScroll=document.documentElement.scrollTop||document.body.scrollTop;var parentWidth=this.options.container=='body'?window.innerWidth:$parent.outerWidth();var parentHeight=this.options.container=='body'?window.innerHeight:$parent.outerHeight();var parentLeft=this.options.container=='body'?0:$parent.offset().left;placement=placement=='bottom'&&pos.top+pos.height+actualHeight-docScroll>parentHeight?'top':placement=='top'&&pos.top-docScroll-actualHeight<0?'bottom':placement=='right'&&pos.right+actualWidth>parentWidth?'left':placement=='left'&&pos.left-actualWidth<parentLeft?'right':placement;$tip.removeClass(orgPlacement).addClass(placement);}var calculatedOffset=this.getCalculatedOffset(placement,pos,actualWidth,actualHeight);this.applyPlacement(calculatedOffset,placement);this.$element.trigger('shown.bs.'+this.type);}};Tooltip.prototype.applyPlacement=function(offset,placement){var replace;var $tip=this.tip();var width=$tip[0].offsetWidth;var height=$tip[0].offsetHeight;var marginTop=parseInt($tip.css('margin-top'),10);var marginLeft=parseInt($tip.css('margin-left'),10);if(isNaN(marginTop))marginTop=0;if(isNaN(marginLeft))marginLeft=0;offset.top=offset.top+marginTop;offset.left=offset.left+marginLeft;$tip.offset(offset).addClass('in');var actualWidth=$tip[0].offsetWidth;var actualHeight=$tip[0].offsetHeight;if(placement=='top'&&actualHeight!=height){replace=true;offset.top=offset.top+height-actualHeight;}if(/bottom|top/.test(placement)){var delta=0;if(offset.left<0){delta=offset.left*-2;offset.left=0;$tip.offset(offset);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;}this.replaceArrow(delta-width+actualWidth,actualWidth,'left');}else this.replaceArrow(actualHeight-height,actualHeight,'top');if(replace)$tip.offset(offset);};Tooltip.prototype.replaceArrow=function(delta,dimension,position){this.arrow().css(position,delta?(50*(1-delta/dimension)+"%"):'');};Tooltip.prototype.setContent=function(){var $tip=this.tip();var title=this.getTitle();$tip.find('.tooltip-inner')[this.options.html?'html':'text'](title);$tip.removeClass('fade in top bottom left right');};Tooltip.prototype.hide=function(){var that=this;var $tip=this.tip();var e=$.Event('hide.bs.'+this.type);function complete(){if(that.hoverState!='in')$tip.detach();}this.$element.trigger(e);if(e.isDefaultPrevented())return;$tip.removeClass('in');$.support.transition&&this.$tip.hasClass('fade')?$tip.one($.support.transition.end,complete).emulateTransitionEnd(150):complete();this.$element.trigger('hidden.bs.'+this.type);return this;};Tooltip.prototype.fixTitle=function(){var $e=this.$element;if($e.attr('title')||typeof ($e.attr('data-original-title'))!='string')$e.attr('data-original-title',$e.attr('title')||'').attr('title','');};Tooltip.prototype.hasContent=function(){return this.getTitle();};Tooltip.prototype.getPosition=function(){var el=this.$element[0];return $.extend({},(typeof el.getBoundingClientRect=='function')?el.getBoundingClientRect():{width:el.offsetWidth,height:el.offsetHeight},this.$element.offset());};Tooltip.prototype.getCalculatedOffset=function(placement,pos,actualWidth,actualHeight){return placement=='bottom'?{top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}:placement=='top'?{top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}:placement=='left'?{top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}:{top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width};};Tooltip.prototype.getTitle=function(){var title;var $e=this.$element;var o=this.options;title=$e.attr('data-original-title')||(typeof o.title=='function'?o.title.call($e[0]):o.title);return title;};Tooltip.prototype.tip=function(){return this.$tip=this.$tip||$(this.options.template);};Tooltip.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find('.tooltip-arrow');};Tooltip.prototype.validate=function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null;}};Tooltip.prototype.enable=function(){this.enabled=true;};Tooltip.prototype.disable=function(){this.enabled=false;};Tooltip.prototype.toggleEnabled=function(){this.enabled=!this.enabled;};Tooltip.prototype.toggle=function(e){var self=e?$(e.currentTarget)[this.type](this.getDelegateOptions()).data('bs.'+this.type):this;self.tip().hasClass('in')?self.leave(self):self.enter(self);};Tooltip.prototype.destroy=function(){this.hide().$element.off('.'+this.type).removeData('bs.'+this.type);};var old=$.fn.tooltip;$.fn.tooltip=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.tooltip');var options=typeof option=='object'&&option;if(!data)$this.data('bs.tooltip',(data=new Tooltip(this,options)));if(typeof option=='string')data[option]();});};$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.noConflict=function(){$.fn.tooltip=old;return this;};}(jQuery);+function($){"use strict";var Popover=function(element,options){this.init('popover',element,options);};if(!$.fn.tooltip)throw new Error('Popover requires tooltip.js');Popover.DEFAULTS=$.extend({},$.fn.tooltip.Constructor.DEFAULTS,{placement:'right',trigger:'click',content:'',template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype);Popover.prototype.constructor=Popover;Popover.prototype.getDefaults=function(){return Popover.DEFAULTS;};Popover.prototype.setContent=function(){var $tip=this.tip();var title=this.getTitle();var content=this.getContent();$tip.find('.popover-title')[this.options.html?'html':'text'](title);$tip.find('.popover-content')[this.options.html?'html':'text'](content);$tip.removeClass('fade top bottom left right in');if(!$tip.find('.popover-title').html())$tip.find('.popover-title').hide();};Popover.prototype.hasContent=function(){return this.getTitle()||this.getContent();};Popover.prototype.getContent=function(){var $e=this.$element;var o=this.options;return $e.attr('data-content')||(typeof o.content=='function'?o.content.call($e[0]):o.content);};Popover.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find('.arrow');};Popover.prototype.tip=function(){if(!this.$tip)this.$tip=$(this.options.template);return this.$tip;};var old=$.fn.popover;$.fn.popover=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.popover');var options=typeof option=='object'&&option;if(!data)$this.data('bs.popover',(data=new Popover(this,options)));if(typeof option=='string')data[option]();});};$.fn.popover.Constructor=Popover;$.fn.popover.noConflict=function(){$.fn.popover=old;return this;};}(jQuery);+function($){"use strict";function ScrollSpy(element,options){var href;var process=$.proxy(this.process,this);this.$element=$(element).is('body')?$(window):$(element);this.$body=$('body');this.$scrollElement=this.$element.on('scroll.bs.scroll-spy.data-api',process);this.options=$.extend({},ScrollSpy.DEFAULTS,options);this.selector=(this.options.target||((href=$(element).attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,''))||'')+' .nav li > a';this.offsets=$([]);this.targets=$([]);this.activeTarget=null;this.refresh();this.process();}ScrollSpy.DEFAULTS={offset:10};ScrollSpy.prototype.refresh=function(){var offsetMethod=this.$element[0]==window?'offset':'position';this.offsets=$([]);this.targets=$([]);var self=this;var $targets=this.$body.find(this.selector).map(function(){var $el=$(this);var href=$el.data('target')||$el.attr('href');var $href=/^#\w/.test(href)&&$(href);return($href&&$href.length&&[[$href[offsetMethod]().top+(!$.isWindow(self.$scrollElement.get(0))&&self.$scrollElement.scrollTop()),href]])||null;}).sort(function(a,b){return a[0]-b[0];}).each(function(){self.offsets.push(this[0]);self.targets.push(this[1]);});};ScrollSpy.prototype.process=function(){var scrollTop=this.$scrollElement.scrollTop()+this.options.offset;var scrollHeight=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight;var maxScroll=scrollHeight-this.$scrollElement.height();var offsets=this.offsets;var targets=this.targets;var activeTarget=this.activeTarget;var i;if(scrollTop>=maxScroll)return activeTarget!=(i=targets.last()[0])&&this.activate(i);for(i=offsets.length;i--;)activeTarget!=targets[i]&&scrollTop>=offsets[i]&&(!offsets[i+1]||scrollTop<=offsets[i+1])&&this.activate(targets[i]);};ScrollSpy.prototype.activate=function(target){this.activeTarget=target;$(this.selector).parents('.active').removeClass('active');var selector=this.selector+'[data-target="'+target+'"],'+this.selector+'[href="'+target+'"]';var active=$(selector).parents('li').addClass('active');if(active.parent('.dropdown-menu').length)active=active.closest('li.dropdown').addClass('active');active.trigger('activate.bs.scrollspy');};var old=$.fn.scrollspy;$.fn.scrollspy=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.scrollspy');var options=typeof option=='object'&&option;if(!data)$this.data('bs.scrollspy',(data=new ScrollSpy(this,options)));if(typeof option=='string')data[option]();});};$.fn.scrollspy.Constructor=ScrollSpy;$.fn.scrollspy.noConflict=function(){$.fn.scrollspy=old;return this;};$(window).on('load',function(){$('[data-spy="scroll"]').each(function(){var $spy=$(this);$spy.scrollspy($spy.data());});});}(jQuery);+function($){"use strict";var Tab=function(element){this.element=$(element);};Tab.prototype.show=function(){var $this=this.element;var $ul=$this.closest('ul:not(.dropdown-menu)');var selector=$this.data('target');if(!selector){selector=$this.attr('href');selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'');}if($this.parent('li').hasClass('active'))return;var previous=$ul.find('.active:last a')[0];var e=$.Event('show.bs.tab',{relatedTarget:previous});$this.trigger(e);if(e.isDefaultPrevented())return;var $target=$(selector);this.activate($this.parent('li'),$ul);this.activate($target,$target.parent(),function(){$this.trigger({type:'shown.bs.tab',relatedTarget:previous});});};Tab.prototype.activate=function(element,container,callback){var $active=container.find('> .active');var transition=callback&&$.support.transition&&$active.hasClass('fade');function next(){$active.removeClass('active').find('> .dropdown-menu > .active').removeClass('active');element.addClass('active');if(transition){element[0].offsetWidth;element.addClass('in');}else element.removeClass('fade');if(element.parent('.dropdown-menu'))element.closest('li.dropdown').addClass('active');callback&&callback();}transition?$active.one($.support.transition.end,next).emulateTransitionEnd(150):next();$active.removeClass('in');};var old=$.fn.tab;$.fn.tab=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.tab');if(!data)$this.data('bs.tab',(data=new Tab(this)));if(typeof option=='string')data[option]();});};$.fn.tab.Constructor=Tab;$.fn.tab.noConflict=function(){$.fn.tab=old;return this;};$(document).on('click.bs.tab.data-api','[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault();$(this).tab('show');});}(jQuery);+function($){"use strict";var Affix=function(element,options){this.options=$.extend({},Affix.DEFAULTS,options);this.$window=$(window).on('scroll.bs.affix.data-api',$.proxy(this.checkPosition,this)).on('click.bs.affix.data-api',$.proxy(this.checkPositionWithEventLoop,this));this.$element=$(element);this.affixed=this.unpin=null;this.checkPosition();};Affix.RESET='affix affix-top affix-bottom';Affix.DEFAULTS={offset:0};Affix.prototype.checkPositionWithEventLoop=function(){setTimeout($.proxy(this.checkPosition,this),1);};Affix.prototype.checkPosition=function(){if(!this.$element.is(':visible'))return;var scrollHeight=$(document).height();var scrollTop=this.$window.scrollTop();var position=this.$element.offset();var offset=this.options.offset;var offsetTop=offset.top;var offsetBottom=offset.bottom;if(typeof offset!='object')offsetBottom=offsetTop=offset;if(typeof offsetTop=='function')offsetTop=offset.top();if(typeof offsetBottom=='function')offsetBottom=offset.bottom();var affix=this.unpin!=null&&(scrollTop+this.unpin<=position.top)?false:offsetBottom!=null&&(position.top+this.$element.height()>=scrollHeight-offsetBottom)?'bottom':offsetTop!=null&&(scrollTop<=offsetTop)?'top':false;if(this.affixed===affix)return;if(this.unpin)this.$element.css('top','');this.affixed=affix;this.unpin=affix=='bottom'?position.top-scrollTop:null;this.$element.removeClass(Affix.RESET).addClass('affix'+(affix?'-'+affix:''));if(affix=='bottom')this.$element.offset({top:document.body.offsetHeight-offsetBottom-this.$element.height()});};var old=$.fn.affix;$.fn.affix=function(option){return this.each(function(){var $this=$(this);var data=$this.data('bs.affix');var options=typeof option=='object'&&option;if(!data)$this.data('bs.affix',(data=new Affix(this,options)));if(typeof option=='string')data[option]();});};$.fn.affix.Constructor=Affix;$.fn.affix.noConflict=function(){$.fn.affix=old;return this;};$(window).on('load',function(){$('[data-spy="affix"]').each(function(){var $spy=$(this);var data=$spy.data();data.offset=data.offset||{};if(data.offsetBottom)data.offset.bottom=data.offsetBottom;if(data.offsetTop)data.offset.top=data.offsetTop;$spy.affix(data);});});}(jQuery);
+function($){"use strict";var isIE=window.navigator.appName=='Microsoft Internet Explorer';var Fileinput=function(element,options){this.$element=$(element);this.$input=this.$element.find(':file');if(this.$input.length===0)return;this.name=this.$input.attr('name')||options.name;this.$hidden=this.$element.find('input[type=hidden][name="'+this.name+'"]');if(this.$hidden.length===0)this.$hidden=$('<input type="hidden">').insertBefore(this.$input);this.$preview=this.$element.find('.fileinput-preview');var height=this.$preview.css('height');if(this.$preview.css('display')!=='inline'&&height!=='0px'&&height!=='none')this.$preview.css('line-height',height);this.original={exists:this.$element.hasClass('fileinput-exists'),preview:this.$preview.html(),hiddenVal:this.$hidden.val()};this.listen();};Fileinput.prototype.listen=function(){this.$input.on('change.bs.fileinput',$.proxy(this.change,this));$(this.$input[0].form).on('reset.bs.fileinput',$.proxy(this.reset,this));this.$element.find('[data-trigger="fileinput"]').on('click.bs.fileinput',$.proxy(this.trigger,this));this.$element.find('[data-dismiss="fileinput"]').on('click.bs.fileinput',$.proxy(this.clear,this));},Fileinput.prototype.change=function(e){var files=e.target.files===undefined?(e.target&&e.target.value?[{name:e.target.value.replace(/^.+\\/,'')}]:[]):e.target.files;e.stopPropagation();if(files.length===0){this.clear();return;}this.$hidden.val('');this.$hidden.attr('name','');this.$input.attr('name',this.name);var file=files[0];if(this.$preview.length>0&&(typeof file.type!=="undefined"?file.type.match(/^image\/(gif|png|jpeg)$/):file.name.match(/\.(gif|png|jpe?g)$/i))&&typeof FileReader!=="undefined"){var reader=new FileReader();var preview=this.$preview;var element=this.$element;reader.onload=function(re){var $img=$('<img>');$img[0].src=re.target.result;files[0].result=re.target.result;element.find('.fileinput-filename').text(file.name);if(preview.css('max-height')!='none')$img.css('max-height',parseInt(preview.css('max-height'),10)-parseInt(preview.css('padding-top'),10)-parseInt(preview.css('padding-bottom'),10)-parseInt(preview.css('border-top'),10)-parseInt(preview.css('border-bottom'),10));preview.html($img);element.addClass('fileinput-exists').removeClass('fileinput-new');element.trigger('change.bs.fileinput',files);};reader.readAsDataURL(file);}else{this.$element.find('.fileinput-filename').text(file.name);this.$preview.text(file.name);this.$element.addClass('fileinput-exists').removeClass('fileinput-new');this.$element.trigger('change.bs.fileinput');}},Fileinput.prototype.clear=function(e){if(e)e.preventDefault();this.$hidden.val('');this.$hidden.attr('name',this.name);this.$input.attr('name','');if(isIE){var inputClone=this.$input.clone(true);this.$input.after(inputClone);this.$input.remove();this.$input=inputClone;}else this.$input.val('');this.$preview.html('');this.$element.find('.fileinput-filename').text('');this.$element.addClass('fileinput-new').removeClass('fileinput-exists');if(e!==undefined){this.$input.trigger('change');this.$element.trigger('clear.bs.fileinput');}},Fileinput.prototype.reset=function(){this.clear();this.$hidden.val(this.original.hiddenVal);this.$preview.html(this.original.preview);this.$element.find('.fileinput-filename').text('');if(this.original.exists)this.$element.addClass('fileinput-exists').removeClass('fileinput-new');else this.$element.addClass('fileinput-new').removeClass('fileinput-exists');this.$element.trigger('reset.bs.fileinput');},Fileinput.prototype.trigger=function(e){this.$input.trigger('click');e.preventDefault();};var old=$.fn.fileinput;$.fn.fileinput=function(options){return this.each(function(){var $this=$(this),data=$this.data('bs.fileinput');if(!data)$this.data('bs.fileinput',(data=new Fileinput(this,options)));if(typeof options=='string')data[options]();});};$.fn.fileinput.Constructor=Fileinput;$.fn.fileinput.noConflict=function(){$.fn.fileinput=old;return this;};$(document).on('click.fileinput.data-api','[data-provides="fileinput"]',function(e){var $this=$(this);if($this.data('bs.fileinput'))return;$this.fileinput($this.data());var $target=$(e.target).closest('[data-dismiss="fileinput"],[data-trigger="fileinput"]');if($target.length>0){e.preventDefault();$target.trigger('click.bs.fileinput');}});}(window.jQuery);
var canvasWidth=1000;var elementPadding=40;var logos={'lunchbox':{whitePath:'../img/icon-lunchbox-white.svg',blackPath:'../img/icon-lunchbox-black.svg',w:100,h:80,display:'Lunchbox'},'socializr':{whitePath:'../img/icon-socializr-white.svg',blackPath:'../img/icon-socializr-black.svg',w:150,h:51,display:'Socializr'}};var whiteLogoAlpha='0.8';var blackLogoAlpha='0.6';var fontWeight='normal';var fontSize='20pt';var fontFace="Helvetica";var fontShadow='rgba(0,0,0,0.7)';var fontShadowOffsetX=0;var fontShadowOffsetY=0;var fontShadowBlur=10;var orgName='Your News Organization';var freelanceString='for '+orgName;var copyrightOptions={'internal':{showPhotographer:true,showSource:false,photographerRequired:false,sourceRequired:false,source:orgName,display:orgName},'freelance':{showPhotographer:true,showSource:false,photographerRequired:true,sourceRequired:false,source:freelanceString,display:'Freelance'},'ap':{showPhotographer:true,showSource:false,photographerRequired:false,sourceRequired:false,source:'AP',display:'AP'},'getty':{showPhotographer:true,showSource:false,photographerRequired:false,sourceRequired:false,source:'Getty Images',display:'Getty'},'thirdParty':{showPhotographer:true,showSource:true,photographerRequired:false,sourceRequired:true,source:'',display:'Third Party/Courtesy'}};var currentCrop='twitter';var currentLogo='lunchbox';var currentLogoColor='white';var currentTextColor='white';var defaultImage='../img/test-kitten.jpg';var defaultLogo=logos[currentLogo].whitePath;
var $source;var $photographer;var $save;var $textColor;var $logo;var $crop;var $logoColor;var $imageLoader;var $canvas;var canvas;var $qualityQuestions;var $copyrightHolder;var $dragHelp;var $filename;var $fileinput;var $customFilename;var IS_MOBILE=Modernizr.touch&&Modernizr.mq('screen and max-width(700px)');var MIME_TYPES=['image/jpeg','image/png','image/gif'];var scaledImageHeight;var scaledImageWidth;var previewScale=IS_MOBILE?0.32:0.64;var dy=0;var dx=0;var image;var imageFilename='image';var currentCopyright;var credit='Belal Khan/Flickr';var shallowImage=false;var ctx;var img=new Image();var logo=new Image();var onDocumentLoad=function(e){$source=$('#source');$photographer=$('#photographer');$canvas=$('#imageCanvas');canvas=$canvas[0];$imageLoader=$('#imageLoader');ctx=canvas.getContext('2d');$save=$('.save-btn');$textColor=$('input[name="textColor"]');$crop=$('input[name="crop"]');$logoColor=$('input[name="logoColor"]');$qualityQuestions=$('.quality-question');$copyrightHolder=$('.copyright-holder');$dragHelp=$('.drag-help');$filename=$('.fileinput-filename');$fileinput=$('.fileinput');$customFilename=$('.custom-filename');$logosWrapper=$('.logos-wrapper');img.src=defaultImage;img.onload=onImageLoad;logo.src=defaultLogo;logo.onload=renderCanvas;$photographer.on('keyup',renderCanvas);$source.on('keyup',renderCanvas);$imageLoader.on('change',handleImage);$save.on('click',onSaveClick);$textColor.on('change',onTextColorChange);$logoColor.on('change',onLogoColorChange);$crop.on('change',onCropChange);$canvas.on('mousedown touchstart',onDrag);$copyrightHolder.on('change',onCopyrightChange);$customFilename.on('click',function(e){e.stopPropagation();});$("body").on("contextmenu","canvas",function(e){return false;});$(window).on('resize',resizeCanvas);resizeCanvas();buildForm();};var resizeCanvas=function(){var scale=$('.canvas-cell').width()/canvasWidth;$canvas.css({'webkitTransform':'scale('+scale+')','MozTransform':'scale('+scale+')','msTransform':'scale('+scale+')','OTransform':'scale('+scale+')','transform':'scale('+scale+')'});renderCanvas();};var buildForm=function(){var copyrightKeys=Object.keys(copyrightOptions);var logoKeys=Object.keys(logos);for(var i=0;i<copyrightKeys.length;i++){var key=copyrightKeys[i];var display=copyrightOptions[key].display;$copyrightHolder.append('<option value="'+key+'">'+display+'</option>');}if(logoKeys.length>1){$logosWrapper.append('<div class="btn-group btn-group-justified btn-group-sm logos" data-toggle="buttons"></div>');var $logos=$('.logos');for(var j=0;j<logoKeys.length;j++){var key=logoKeys[j];var display=logos[key].display;$logos.append('<label class="btn btn-primary"><input type="radio" name="logo" id="'+key+'" value="'+key+'">'+display+'</label>');disableLogo();if(key===currentLogo){$('#'+key).attr('checked',true);$('#'+key).parent('.btn').addClass('active');}}$logo=$('input[name="logo"]');$logo.on('change',onLogoChange);}else $logosWrapper.hide();};var renderCanvas=function(){canvas.width=canvasWidth;if(currentCrop!=='original')canvas.height=canvasWidth/(16/9);ctx.clearRect(0,0,canvas.width,canvas.height);var imageAspect=img.width/img.height;if(currentCrop==='original'){canvas.height=canvasWidth/imageAspect;scaledImageHeight=canvas.height;ctx.drawImage(img,0,0,canvasWidth,scaledImageHeight);}else if(img.width/img.height>canvas.width/canvas.height){shallowImage=true;scaledImageHeight=canvasWidth/imageAspect;scaledImageWidth=canvas.height*(img.width/img.height);ctx.drawImage(img,0,0,img.width,img.height,dx,dy,scaledImageWidth,canvas.height);}else{shallowImage=false;scaledImageHeight=canvasWidth/imageAspect;ctx.drawImage(img,0,0,img.width,img.height,dx,dy,canvasWidth,scaledImageHeight);}if(currentLogoColor==='white')ctx.globalAlpha=whiteLogoAlpha;else ctx.globalAlpha=blackLogoAlpha;ctx.drawImage(logo,elementPadding,currentLogo==='npr'?elementPadding:elementPadding-14,logos[currentLogo].w,logos[currentLogo].h);ctx.globalAlpha="1";ctx.textBaseline='bottom';ctx.textAlign='left';ctx.fillStyle=currentTextColor;ctx.font=fontWeight+' '+fontSize+' '+fontFace;if(currentTextColor==='white'){ctx.shadowColor=fontShadow;ctx.shadowOffsetX=fontShadowOffsetX;ctx.shadowOffsetY=fontShadowOffsetY;ctx.shadowBlur=fontShadowBlur;}if(currentCopyright)credit=buildCreditString();var creditWidth=ctx.measureText(credit);ctx.fillText(credit,canvas.width-(creditWidth.width+elementPadding),canvas.height-elementPadding);validateForm();};var buildCreditString=function(){var creditString;var val=$copyrightHolder.val();if($photographer.val()!=='')if(copyrightOptions[val].source)creditString=$photographer.val()+'/'+copyrightOptions[val].source;else creditString=$photographer.val()+'/'+$source.val();else if(copyrightOptions[val].source)creditString=copyrightOptions[val].source;else creditString=$source.val();if(copyrightOptions[val].photographerRequired)if($photographer.val()!=='')$photographer.parents('.form-group').removeClass('has-warning');else $photographer.parents('.form-group').addClass('has-warning');if(copyrightOptions[val].sourceRequired)if($source.val()!=='')$source.parents('.form-group').removeClass('has-warning');else $source.parents('.form-group').addClass('has-warning');return creditString;};var validateForm=function(){if($('.has-warning').length===0&&currentCopyright){$save.removeAttr('disabled');$("body").off("contextmenu","canvas");}else{$save.attr('disabled','');$("body").on("contextmenu","canvas",function(e){return false;});}};var onDrag=function(e){e.preventDefault();var originY=e.clientY||e.originalEvent.targetTouches[0].clientY;originY=originY/previewScale;var originX=e.clientX||e.originalEvent.targetTouches[0].clientX;originX=originX/previewScale;var startY=dy;var startX=dx;if(currentCrop==='original')return;function update(e){var dragY=e.clientY||e.originalEvent.targetTouches[0].clientY;dragY=dragY/previewScale;var dragX=e.clientX||e.originalEvent.targetTouches[0].clientX;dragX=dragX/previewScale;if(shallowImage===false){if(Math.abs(dragY-originY)>1){dy=startY-(originY-dragY);if(dy>0){dy=0;return;}if(dy<canvas.height-scaledImageHeight){dy=canvas.height-scaledImageHeight;return;}renderCanvas();}}else if(Math.abs(dragX-originX)>1){dx=startX-(originX-dragX);if(dx>0){dx=0;return;}if(dx<canvas.width-scaledImageWidth){dx=canvas.width-scaledImageWidth;return;}renderCanvas();}}$(document).on('mousemove.drag touchmove',_.debounce(update,5,true)).on('mouseup.drag touchend',function(e){$(document).off('mouseup.drag touchmove mousemove.drag');update(e);});};var handleImage=function(e){var reader=new FileReader();reader.onload=function(e){dy=0;dx=0;image=e.target.result;imageFilename=$('.fileinput-filename').text().split('.')[0];img.src=image;$customFilename.text(imageFilename);$customFilename.parents('.form-group').addClass('has-file');};reader.readAsDataURL(e.target.files[0]);};var onImageLoad=function(e){renderCanvas();onCropChange();};var loadLogo=function(){if(currentLogoColor==='white')logo.src=logos[currentLogo].whitePath;else logo.src=logos[currentLogo].blackPath;disableLogo();};var disableLogo=function(){var whiteLogo=logos[currentLogo].whitePath;var blackLogo=logos[currentLogo].blackPath;if(typeof whiteLogo=="undefined")$("#whiteLogo").parent().addClass("disabled");else $("#whiteLogo").parent().removeClass("disabled");if(typeof blackLogo=="undefined")$("#blackLogo").parent().addClass("disabled");else $("#blackLogo").parent().removeClass("disabled");};var onSaveClick=function(e){e.preventDefault();var link=document.createElement('a'),e;if($customFilename.text())imageFilename=$customFilename.text();link.download='waterbug-'+imageFilename+'.png';link.href=canvas.toDataURL();link.target="_blank";if(document.createEvent){e=document.createEvent("MouseEvents");e.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);link.dispatchEvent(e);}else if(link.fireEvent)link.fireEvent("onclick");};var onLogoColorChange=function(e){currentLogoColor=$(this).val();loadLogo();renderCanvas();};var onTextColorChange=function(e){currentTextColor=$(this).val();renderCanvas();};var onLogoChange=function(e){currentLogo=$(this).val();loadLogo();renderCanvas();};var onCropChange=function(){currentCrop=$crop.filter(':checked').val();if(currentCrop!=='original'){var dragClass=shallowImage?'is-draggable shallow':'is-draggable';$canvas.addClass(dragClass);$dragHelp.show();}else{$canvas.removeClass('is-draggable shallow');$dragHelp.hide();}renderCanvas();};var onCopyrightChange=function(){currentCopyright=$copyrightHolder.val();$photographer.parents('.form-group').removeClass('has-warning');$source.parents('.form-group').removeClass('has-warning');if(copyrightOptions[currentCopyright]){if(copyrightOptions[currentCopyright].showPhotographer){$photographer.parents('.form-group').slideDown();if(copyrightOptions[currentCopyright].photographerRequired)$photographer.parents('.form-group').addClass('has-warning required');else $photographer.parents('.form-group').removeClass('required');}else $photographer.parents('.form-group').slideUp();if(copyrightOptions[currentCopyright].showSource){$source.parents('.form-group').slideDown();if(copyrightOptions[currentCopyright].sourceRequired)$source.parents('.form-group').addClass('has-warning required');else $source.parents('.form-group').removeClass('required');}else $source.parents('.form-group').slideUp();}else{$photographer.parents('.form-group').slideUp();$source.parents('.form-group').slideUp();credit='';}renderCanvas();};$(onDocumentLoad);